<%-include('v_head',{title:'Home'})%>
  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css"
    integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <%-include('v_nav')%>
    <link rel="stylesheet" href="assets/dist/css/home.css">
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <body class="bg-light mb-3 pb-3">
      <h3 class="mt-4 text-center">Home</h3>
      <center>
        <div class="rounded-pill bg-info m-3 mt-4 mb-0 p-3 pb-0 pl-4 d-flex flex-row justify-content-between">
          <div class="m-1 pt-1 w-25">
            <h6 class="text-white text-left font-weight-normal">Jumlah Peminjaman Aktif</h6>
              <h2 class="text-white text-left font-weight-normal peminjaman-aktif">
                
              </h2>
          </div>
          <div class="m-1 pt-1" style="width:270px">
            <h6 class="text-white text-left font-weight-normal">Jumlah Peminjaman Terlambat</h6>
            <h2 class="text-white text-left font-weight-normal peminjaman-terlambat">
              
            </h2>
          </div>
          <div class="m-1 pt-1" style="width:270px">
            <h6 class="text-white text-left font-weight-normal">Jumlah DVD Dipinjam</h6>
            <h2 class="text-white text-left font-weight-normal dvd-dipinjam">
              
            </h2>
          </div>
          <div class="m-1 pt-1" style="width:270px">
            <h6 class="text-white text-left font-weight-normal">Jumlah DVD Tersedia</h6>
            <h2 class="text-white text-left font-weight-normal dvd-tersedia">
              
            </h2>
          </div>
        </div>
        <div class=" d-flex flex-row justify-content-between">
          <div class="bg-success w-50 p-3 rounded-pill shadow-lg m-3 mt-1 d-flex flex-row justify-content-around">
            <div class="">
              <h6 class="text-white font-weight-normal ">Pemasukan Bulan Ini</h6>
              <h3 class="text-white font-weight-normal pemasukan-bulan-ini"><i
                    class="bi bi-chevron-double-up" style="font-size:30px;margin-left:10px;color: rgb(6, 88, 43);"></i>
              </h3>
            </div>
            <div class="">
              <h6 class="text-white font-weight-normal ">Pemasukan Hari Ini</h6>
              <h3 class="text-white font-weight-normal pemasukan-hari-ini"><i
                    class="bi bi-chevron-double-up" style="font-size:30px;margin-left:10px;color: rgb(6, 88, 43);"></i>
              </h3>
            </div>
          </div>
          <div class="bg-danger w-50 p-3 rounded-pill shadow-lg m-3 mt-1 d-flex flex-row justify-content-around">
            <div class="">
              <h6 class="text-white font-weight-normal ">Pengeluaran Bulan Ini</h6>
              <h3 class="text-white font-weight-normal pengeluaran-bulan-ini"><i
                    class="bi bi-chevron-double-down" style="font-size:30px;margin-left:10px;color: rgb(68, 5, 5);"></i>
              </h3>
            </div>
            <div class="">
              <h6 class="text-white font-weight-normal ">Pengeluaran Hari Ini</h6>
              <h3 class="text-white font-weight-normal pengeluaran-hari-ini"><i
                    class="bi bi-chevron-double-down"
                    style="font-size:30px;margin-left:10px;color:  rgb(68, 5, 5);"></i></h3>
            </div>

          </div>
        </div>
        <div class="card w-75 mt-4">
          <div class="card-header bg-info text-white">
            Grafik Bulanan
          </div>
          <div class="card-body">
            <canvas id="myChart"></canvas>
          </div>
        </div>
      </center>
    </body>
    <script src="/assets/dist/js/home.js"></script>
    <script type="module">
      import "../node_modules/chart.js/dist/chart.js"
      $(document).ready(() => {
        let date_now = new Date()
        $.ajax({
          url: '/get/keuangan_bulanan',
          method: 'POST',
          success: result => {
            const labels = [
            'Januari',
            'Februari',
            'Maret',
            'April',
            'Mei',
            'Juni',
            'Juli',
            'Agustus',
            'September',
            'Oktober',
            'November',
            'Desember',
          ];

            const data = {
            labels: labels,
            datasets: [{
              label: 'Pemasukan Bulanan',
              backgroundColor: 'rgb(15, 107, 40)',
              borderColor: 'rgb(15, 107, 40)',
              data: result.pemasukan
            }, {
              label: 'Pengeluaran Bulanan',
              backgroundColor: 'rgb(207, 56, 45)',
              borderColor: 'rgb(207, 56, 45)',
              data: result.pengeluaran
            }]
          };

          const config = {
            type: 'line',
            data: data,
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'top',
                },
                title: {
                  display: true,
                  text: `Data Tahun ${date_now.getFullYear()}`
                }
              }
            },
          };

          const myChart = new Chart(
            document.getElementById('myChart'),
            config
          );

          }
        })
        $.ajax({
          url: '/rincian_keuangan',
          method: 'POST',
          success: result => {
            $('.pemasukan-bulan-ini').html('Rp '+result.pemasukan_bulan_ini.toLocaleString('ID'))
            $('.pemasukan-hari-ini').html('Rp '+result.pemasukan_hari_ini.toLocaleString('ID'))
            $('.pengeluaran-bulan-ini').html('Rp '+result.pengeluaran_bulan_ini.toLocaleString('ID'))
            $('.pengeluaran-hari-ini').html('Rp '+result.pengeluaran_hari_ini.toLocaleString('ID'))
          }
        })
        $.ajax({
          url: '/rincian_peminjaman',
          method: 'POST',
          success: result => {
            $('.peminjaman-aktif').html('Rp '+result.peminjaman_aktif.toLocaleString('ID'))
            $('.peminjaman-terlambat').html('Rp '+result.peminjaman_terlambat.toLocaleString('ID'))
            $('.dvd-tersedia').html('Rp '+result.dvd_tersedia.toLocaleString('ID'))
            $('.dvd-dipinjam').html('Rp '+result.dvd_dipinjam.toLocaleString('ID'))
          }
        })
      })

    </script>
    <%-include('v_foot')%>